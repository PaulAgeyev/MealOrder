<script src="../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">

<dom-module id="vendor-menus">
    <template>
        <style>
            :host {
                display: block;
                padding: 0;
            }

            body {
                height: 100vh;
                margin: 0;
                display: flex;
                flex-direction: column;
            }

            app-toolbar {
                background-color: var(--google-green-700);
                box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.3);
                font-weight: bold;
                color: white;
                font-size: 18px;
                z-index: 1;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
            }

            app-toolbar paper-icon-button {
                --paper-icon-button-ink-color: white;
            }

            iron-list {
                --iron-list-items-container: {
                    width: 70%;
                    margin: 2% auto;
                    border-bottom: 1px solid #ddd;
                };
            }

            div[role="listbox"] {
                border: 1px solid #e5e5e5;
            }

            paper-input {
                width: 70%;
                margin: 2% auto;
                border-radius: 5px;
                background-color: #ffffff;
                padding: 0;
                --paper-input-container: {
                    padding: 0;
                    --paper-input-container-focus-color: gray;
                }
            }
            paper-item {
                width: 100%;
            }

            .item {
                @apply --layout-horizontal;
                /*padding: 20px;*/
                background-color: white;
                border: 1px solid #ddd;
                cursor: pointer;
                margin-bottom: 10px;
            }

            .pad {
                padding: 15px;
                @apply --layout-flex;
                @apply --layout-vertical;

            }

            .vendor-category {
                color: gray;
                display: none;
                margin-left: 3%;
                font-size: 14px;
            }

            .item.expand .vendor-category {
                display: block;
            }

            .spacer {
                @apply --layout-flex;
            }

            @media (max-width: 460px) {
                paper-toolbar .bottom.title {
                    font-size: 14px;
                }
            }

            #expand-button {
                position: absolute;
                right: 0;
                top: 7px;
            }

            .primary {
                font-size: 16px;
            }

            .menu-dashboard {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .dish-category {
                width: 50%;
            }

            .menu-price {
                width: 50%;
            }

            .dish-icon {
                width: 40px;
            }

            .dish-title {
                width: 50%;
            }

            .dish-price {
                width: 40%;
                padding-left: 25px;
            }

            .add-dish-icon {
                margin-bottom: 2px;
            }

            .dish-category {
                padding-top: 20px;
                padding-left: 17px;
                width: 60%;
            }

            .dish-title {
                width: 60%;
            }

            .menu-price {
                width: 40%;
            }

            .non-select {
                -webkit-touch-callout: none; /* iOS Safari */
                -webkit-user-select: none; /* Safari */
                -khtml-user-select: none; /* Konqueror HTML */
                -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
                user-select: none;
                /* Non-prefixed version, currently
                                                 supported by Chrome and Opera */
            }

            @media only screen and (max-width: 600px) {
                iron-list {
                    --iron-list-items-container: {
                        margin: 4% auto;
                        width: 100%;
                    }
                }

                .dish-price {
                    padding-left: 30px;
                }

            }
        </style>
        <paper-input value="{{filter}}" label="search" --paper-input-container-underline-disabled="true">
            <iron-icon icon="search" slot="prefix"></iron-icon>
        </paper-input>

        <iron-list scroll-target="document" id="list" items="[[filtered]]" as="item" selection-enabled
                   multi-selection on-selected-items-changed="selectionChanged">
            <template>
                <div class="non-select">
                    <div class$="[[getClassForItem(selected)]]" tabindex$="[[tabIndex]]">
                        <div class="pad">
                            <div class="primary">
                                [[item.name]]
                                <paper-icon-button id="expand-button" icon="[[getIcon(selected)]]"
                                                   on-click="_reSelect"></paper-icon-button>

                            </div>
                            <div class="vendor-category">
                                <div style="display: flex; justify-content: space-between;">
                                    <div class="dish-category">
                                        Блюдо
                                    </div>
                                    <div class="menu-price">
                                        Цена
                                    </div>
                                    <div class="dish-icon">
                                    </div>
                                </div>
                                <dom-repeat items="[[item.dishes]]" as="dish">
                                    <template>
                                        <div class="menu-dashboard">
                                            <paper-item>
                                                <div class="dish-title">
                                                    [[dish.title]]
                                                </div>
                                                <div class="dish-price">
                                                    [[dish.price]]₴
                                                </div>
                                                <div class="add-dish-icon">
                                                    <paper-icon-button icon="add"></paper-icon-button>
                                                </div>
                                            </paper-item>
                                        </div>
                                    </template>
                                </dom-repeat>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </iron-list>

    </template>
    <script>
        class VendorMenus extends Polymer.Element {
            static get is() {
                return 'vendor-menus';
            }

            static get properties() {
                return {
                    items: {
                        type: Array,
                        value: [
                            {
                                name: 'Пюре',
                                dishes: [
                                    {title: 'Борщ украинский', price: 35},
                                    {title: 'Солянка', price: 40},
                                    {title: 'Суп гороховый', price: 40},
                                    {title: 'Уха', price: 35},
                                    {title: 'Суп-пюре грибной', price: 40},
                                    {title: 'Суп куриный', price: 40}]
                            },
                            {
                                name: 'Позитив',
                                dishes: [{title: 'Суп куриный', price: 35}, {title: 'Стейк из лосося', price: 35}]
                            },]
                    },
                    filtered: {
                        type: Array,
                        computed: 'filteredItems(filter)',
                        reflectToAttribute: true
                    },
                    filter: {
                        type: String,
                        value: '',
                        notify: true
                    },
                    selectedVendors: {
                        type: Array,
                        value: []
                    }
                }
            };

            static get observers() {
                return [
                    '_handleInput(filter)'
                ];
            }

            _handleInput() {
                const div = this.shadowRoot.querySelector("#list");
                for (let i = 0; i < this.items.length; i++) {
                    div.selectIndex(i);
                    div.selectIndex(i);
                }
            }

            filteredItems() {
                const predicate = this.filter;
                const filtered = [];
                for (let i = 0; i < this.items.length; i++) {
                    const vendorDishes = this.items[i].dishes;
                    let newVendorDishes = [];
                    for (let j = 0; j < vendorDishes.length; j++) {
                        if (vendorDishes[j].title.toLowerCase().includes(predicate.toLowerCase())) {
                            newVendorDishes.push(vendorDishes[j]);
                        }
                    }
                    filtered.push({name: this.items[i].name, dishes: newVendorDishes});
                }


                return filtered;
            }

            selectionChanged(e) {
                const div = this.shadowRoot.querySelector("#list");
                this.set('selectedVendors', div.selectedItems);
            }


            attached() {
                // Use the document element
                this.$.list.scrollTarget = this.ownerDocument.documentElement;
            };

            getClassForItem(selected) {
                return selected ? 'item expand' : 'item';
            };

            getIcon(selected) {
                if (selected) {
                    return 'expand-less';
                }
                else {
                    return 'expand-more';

                }
            }

            _reSelect(e) {
                const div = this.shadowRoot.querySelector("#list");
                if (!e.model.selected) {
                    div.selectIndex(e.model.index);
                }
                else {
                    div.deselectIndex(e.model.index);
                }
            }
        }

        window.customElements.define(VendorMenus.is, VendorMenus);
    </script>
</dom-module>
